<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A+ CHAOS CORE | BEHAVIORAL SECURITY & DATA HYDRATION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');
        
        body { background-color: #050505; color: #e5e5e5; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        h1, h2, h3, .mono { font-family: 'JetBrains Mono', monospace; }
        .hero-bg { background: radial-gradient(circle at 50% 30%, #002200 0%, #000000 60%); min-height: 100vh; }
        
        /* CONTENT SKELETON: Filter is for human eyes during authentication */
        .scramble-content {
            filter: blur(8px);
            user-select: none; 
            opacity: 0.3;
            transition: filter 0.3s ease-out, opacity 0.5s;
        }
        .clear-vision { filter: blur(0px) !important; opacity: 1 !important; user-select: auto !important; }
        
        /* SENTINEL HUD */
        .sentinel-hud {
            position: fixed; bottom: 20px; right: 20px; width: 240px;
            background: rgba(5, 5, 5, 0.9); border: 1px solid #1a1a1a;
            padding: 15px; border-radius: 4px; z-index: 999;
            font-family: 'JetBrains Mono', monospace; backdrop-filter: blur(10px);
            border-left: 2px solid #00ff41;
            transition: opacity 0.5s;
        }
        .hud-bar { height: 4px; background: #222; margin-top: 8px; border-radius: 2px; overflow: hidden; }
        .hud-fill { height: 100%; background: #00ff41; width: 100%; transition: width 0.3s ease-out; }

        /* Security Block */
        #bot-lockout {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000; flex-direction: column;
            align-items: center; justify-content: center; text-align: center;
        }
    </style>
</head>
<body class="hero-bg">

    <div id="bot-lockout">
        <i class="fas fa-robot text-6xl text-red-600 mb-6 animate-pulse"></i>
        <h1 class="text-3xl font-bold text-red-500 mono mb-2">ACCESS DENIED</h1>
        <p class="text-gray-500 text-sm mono">NON-HUMAN CHAOS DETECTED. SESSION TERMINATED.</p>
        <button onclick="location.reload()" class="mt-8 border border-red-800 text-red-500 px-6 py-2 rounded text-xs hover:bg-red-900/20">
            REQUEST HUMAN REVIEW
        </button>
    </div>

    <nav class="fixed w-full z-50 px-6 py-6 flex justify-between items-center backdrop-blur-md border-b border-white/5 bg-black/50">
        <div class="text-xl font-bold tracking-tighter text-white mono">
            A+ <span class="text-green-500">CHAOS CORE</span>
        </div>
        <div class="space-x-6 flex items-center">
            <a href="/app" class="text-xs font-bold text-gray-400 hover:text-white transition tracking-widest">SECURE LOGIN</a>
            <a href="/dashboard" class="bg-green-600 hover:bg-green-500 text-white px-5 py-2 rounded-sm text-xs font-bold transition tracking-widest">
                COMMAND CENTER
            </a>
        </div>
    </nav>

    <div class="relative z-10 pt-40 px-6 max-w-6xl mx-auto pb-24">
        <section class="text-center space-y-8 mb-24">
            <div class="inline-flex items-center gap-2 border border-green-500/30 bg-green-900/10 px-4 py-1.5 rounded-full mb-4">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                <span class="text-[10px] text-green-400 tracking-[0.2em] font-bold mono">V159 CHAOS HANDLER ACTIVE</span>
            </div>
            
            <h1 class="text-5xl md:text-8xl font-black tracking-tighter leading-none text-white">
                DEFENSE AGAINST <br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-red-600">AI DATA LEAKAGE</span>
            </h1>
            
            <p class="text-lg md:text-xl text-gray-400 max-w-2xl mx-auto leading-relaxed">
                We secure physical assets, intellectual property, and infrastructure from the next generation of automated threats.
            </p>

            <div class="flex flex-col md:flex-row justify-center gap-4 pt-4">
                <a href="/app" class="bg-white text-black px-8 py-4 rounded font-bold hover:bg-gray-200 transition tracking-wide">
                    LAUNCH SECURE APP
                </a>
                <button onclick="runBenchmark()" class="border border-green-800 text-green-500 px-8 py-4 rounded font-bold hover:bg-green-900/20 transition tracking-wide">
                    RUN TRIAD AUDIT
                </button>
            </div>
            <div id="benchmark-result" class="h-6 text-xs mono text-green-400 mt-2"></div>
        </section>

        <div id="protected-content" class="scramble-content">
            <div id="content-payload" class="pt-12">
                <div id="content-skeleton" class="text-gray-500 text-sm mono flex items-center justify-center min-h-24">
                    <i class="fas fa-lock text-xl mr-2 animate-pulse"></i> INITIATING JS CHALLENGE...
                </div>
            </div>
        </div>

        <div class="h-screen flex items-center justify-center text-gray-700 font-mono text-xs pt-24">
            SCROLL ACTIVATION INITIATED...
        </div>
    </div>

    <div class="sentinel-hud" id="hud-box">
        <div class="flex justify-between items-center mb-3 pb-2 border-b border-white/10">
            <span class="text-[10px] text-gray-400 tracking-[0.2em] font-bold">CHAOS HANDLER</span>
            <i class="fas fa-eye text-green-500 text-xs" id="hud-icon"></i>
        </div>
        
        <div class="flex justify-between items-end mb-1">
            <span class="text-[10px] text-gray-500 mono">TRUST SCORE</span>
            <span class="text-sm font-bold text-white mono" id="hud-pct">0%</span>
        </div>
        <div class="hud-bar"><div class="hud-fill" id="hud-score" style="width: 0%"></div></div>
        
        <div class="grid grid-cols-2 gap-2 mt-3 pt-2">
            <div>
                <div class="text-[8px] text-gray-500 tracking-wider">LAST PROBE</div>
                <div id="hud-state" class="text-[10px] text-white font-bold mono">INIT</div>
            </div>
            <div class="text-right">
                <div class="text-[8px] text-gray-500 tracking-wider">VERDICT</div>
                <div id="hud-status" class="text-[10px] text-red-500 font-bold mono">LOCKED</div>
            </div>
        </div>
    </div>

    <script>
        // --- Core Sentinel Logic (Unchanged but nested in handler) ---
        const Sentinel = {
            buffer: [], score: 0, lastY: 0, lastT: Date.now(),
            
            analyze: () => {
                const now = Date.now();
                const y = window.scrollY;
                const dt = now - Sentinel.lastT;
                const dy = y - Sentinel.lastY;

                // BOT TRAPS
                if (dt > 150) { Sentinel.lastT = now; Sentinel.lastY = y; updateState("IDLE"); return; }
                if (dt < 2 && Math.abs(dy) > 100) { Chaos.failProbe('SPIKE_TRAP', {dt, dy}); return; } // Failure delegated to Chaos

                updateState("SCROLLING");

                if (Math.abs(dy) > 0) {
                    const velocity = Math.abs(dy / dt);
                    Sentinel.buffer.push(velocity);
                    if(Sentinel.buffer.length > 20) Sentinel.buffer.shift();
                    
                    const variance = Sentinel.calculateVariance(Sentinel.buffer);
                    
                    if(Sentinel.buffer.length > 5) {
                        if(variance < 0.005) {
                            Chaos.trustScore = Math.max(0, Chaos.trustScore - 5);
                            Chaos.updateHUD(); 
                        } else {
                            Chaos.trustScore = Math.min(100, Chaos.trustScore + 2); // Human reward
                            Chaos.updateHUD(); 
                        }
                    }
                }
                Sentinel.lastY = y;
                Sentinel.lastT = now;
            },

            calculateVariance: (arr) => {
                const mean = arr.reduce((a, b) => a + b, 0) / arr.length;
                return arr.reduce((sq, n) => sq + Math.pow(n - mean, 2), 0) / arr.length;
            }
        };

        // --- CHAOS HANDLER V1.0 (Polymorphic Orchestration) ---
        const Chaos = {
            trustScore: 0,
            chaosSeed: localStorage.getItem('chaosSeed') || Math.random().toString(36).substring(2),
            probes: [], // Ledger of active verifications
            
            init: () => {
                Chaos.trustScore = 0; // Start at zero for full verification
                localStorage.setItem('chaosSeed', Chaos.chaosSeed); // Set session seed
                document.getElementById('hud-box').style.opacity = 1;
                
                // 1. Initial JS Hydration Challenge
                Chaos.hydrateContent();

                // 2. Start Scroll Listener (Sentinel V157)
                Sentinel.init();

                // 3. Start Polymorphic Probes (Only after initial hydration)
                // We'll focus on the scroll probe for now, but this is the hook for Heartbeat/Morphing.
            },

            // 1. CONTENT UNLOCK & JS CHALLENGE
            async hydrateContent() {
                const entropy = calculateBrowserEntropy();
                const payload = { timestamp: Date.now(), browserEntropy: entropy };

                const res = await fetch('/api/unlock', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
                });

                const data = await res.json();
                
                if (data.success) {
                    document.getElementById('content-payload').innerHTML = data.content;
                    document.getElementById('protected-content').classList.add('clear-vision');
                    Chaos.trustScore = 80; // Reward successful JS execution
                    Chaos.updateHUD();
                    console.log(">>> [CHAOS] Initial Hydration Success.");
                } else {
                    document.getElementById('content-skeleton').innerHTML = `<i class="fas fa-times-circle text-xl mr-2 text-red-500"></i> HYDRATION FAILED: ${data.error}`;
                    document.getElementById('protected-content').classList.remove('scramble-content');
                }
            },
            
            // 2. PROBE FAILURE DELEGATE
            failProbe(type, details) {
                Chaos.trustScore = Math.max(0, Chaos.trustScore - 20); // Heavier penalty
                Chaos.updateHUD();
                Chaos.logToChaos(type, details);

                if (Chaos.trustScore <= 0) {
                    document.getElementById('bot-lockout').style.display = 'flex';
                    window.removeEventListener('scroll', Sentinel.analyze);
                }
            },

            // 3. TELEMETRY
            logToChaos(type, details) {
                navigator.sendBeacon('/api/chaos-log', JSON.stringify({
                    seed: Chaos.chaosSeed,
                    probe: type,
                    details: details,
                    score: Chaos.trustScore,
                    ua: navigator.userAgent
                }));
            },

            // 4. UI UPDATE
            updateHUD() {
                const score = Chaos.trustScore;
                const fill = document.getElementById('hud-score');
                const pct = document.getElementById('hud-pct');
                const status = document.getElementById('hud-status');
                
                fill.style.width = score + '%';
                pct.innerText = Math.floor(score) + '%';

                if (score > 40) {
                    status.innerText = "VERIFIED";
                    status.style.color = "#00ff41";
                    fill.style.background = "#00ff41";
                } else {
                    status.innerText = "THREAT";
                    status.style.color = "#ff0000";
                    fill.style.background = "#ff0000";
                }
            }
        };

        // --- UTILITY FUNCTIONS ---
        function calculateBrowserEntropy() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top'; ctx.font = '12px Arial';
            ctx.fillText('chaos-id-v159', 2, 2);
            const canvasHash = btoa(ctx.getImageData(0, 0, 1, 1).data); 
            const timeOffset = new Date().getTimezoneOffset();
            return btoa(canvasHash + timeOffset + Math.random().toString());
        }
        function updateState(status) {
            const el = document.getElementById('hud-state');
            el.innerText = status;
            el.style.color = status === "IDLE" ? "#666" : "#fff";
            document.getElementById('hud-box').style.opacity = status === "IDLE" ? "0.6" : "1";
        }
        function runBenchmark() {
            const disp = document.getElementById('benchmark-result');
            disp.innerText = ">> PINGING ENTROPY STREAM...";
            fetch('/api/v1/beta/pulse-demo')
                .then(r => r.json())
                .then(d => {
                    setTimeout(() => {
                        disp.innerText = `>> CHAOS TRIAD PASS: ${d.hash.substring(0,24)}...`;
                    }, 500);
                })
                .catch(() => disp.innerText = ">> CONNECTION ERROR");
        }
        
        Chaos.init();
    </script>
</body>
</html>
