<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Initiation | Overthere.ai</title>
    <link rel="stylesheet" href="css/modern.css">
</head>
<body>

    <div class="init-card">
        <h1 style="color: var(--mint); margin-bottom: 10px;">CHAOS ID</h1>
        <p style="color: var(--slate); font-size: 0.8rem; margin-bottom: 30px;">ESTABLISH YOUR FRAGMENT IN THE METAVERSE</p>
        
        <input type="text" id="csInput" class="input-chaos" placeholder="[ CLAIM_CALLSIGN ]">
        
        <p style="font-size: 0.7rem; color: var(--slate); margin-bottom: 10px;">DRAW YOUR UNIQUE SYMBOL BELOW</p>
        <canvas id="drawCanvas" width="300" height="200"></canvas>
        
        <button class="btn-chaos" onclick="sealIdentity()">Seal Identity</button>
        <button onclick="clearCanvas()" style="background:transparent; color:var(--slate); border:none; margin-top:10px; cursor:pointer; font-size:10px;">CLEAR SYMBOL</button>
    </div>

    <script>
        const canvas = document.getElementById('drawCanvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;
        let entropyPoints = [];

        ctx.strokeStyle = '#00ff9d';
        ctx.lineWidth = 3;
        ctx.lineCap = 'round';

        // --- DRAWING LOGIC & ENTROPY CAPTURE ---
        function startDraw(e) {
            drawing = true;
            ctx.beginPath();
            draw(e);
        }

        function draw(e) {
            if (!drawing) return;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            
            ctx.lineTo(x, y);
            ctx.stroke();
            
            // Capture physical jitter for entropy
            entropyPoints.push(Math.floor(x * y));
        }

        function endDraw() { drawing = false; }

        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        window.addEventListener('mouseup', endDraw);
        canvas.addEventListener('touchstart', startDraw);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', endDraw);

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            entropyPoints = [];
        }

        function sealIdentity() {
            const cs = document.getElementById('csInput').value.trim();
            if(cs.length < 3) return alert("CALLSIGN REQUIRED");
            if(entropyPoints.length < 10) return alert("SYMBOL TOO SIMPLE. PROVIDE MORE ENTROPY.");

            // Create the Chaos Hash from the Drawing
            const drawingHash = btoa(entropyPoints.join('')).substring(0, 32);
            
            // SAVE TO METAVERSE
            localStorage.setItem('CHAOS_CALLSIGN', cs.toUpperCase());
            localStorage.setItem('CHAOS_IDENTITY_HASH', drawingHash);
            
            alert("IDENTITY SEALED. ENTERING THE METAVERSE.");
            window.location.href = '/dashboard.html';
        }
    </script>
</body>
</html>
