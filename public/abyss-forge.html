<script>
    // ... (Previous Canvas Setup) ...
    const Bio = new ChaosBioEngine();
    
    // ... (Drawing Logic) ...

    function success() {
        traces++;
        document.getElementById('fill').style.width = `${(traces/required)*100}%`;
        document.getElementById('status').innerText = `${traces} / ${required}`;

        if(traces >= required) {
            // CAPTURE BEHAVIORAL DNA
            // We use the last (most practiced) trace as the baseline
            const dna = Bio.extractDNA(currentPath);

            const masterData = {
                path: currentPath, 
                speedMod: 1.0,
                // THIS IS THE NEW SECURITY LAYER
                dnaProfile: dna 
            };

            localStorage.setItem('chaos_master_template', JSON.stringify(masterData));
            localStorage.setItem('chaos_trust_score', '50');

            document.getElementById('status').innerText = "BEHAVIORAL DNA LOCKED.";
            document.getElementById('status').classList.add('text-white');
            setTimeout(() => window.location.href = '/login', 1000);
        } else {
            setTimeout(() => { ctx.clearRect(0,0,300,300); drawGuide(); }, 500);
        }
    }
    // ...
</script>
