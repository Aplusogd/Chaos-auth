<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chaos Terminal | Overthere.ai</title>
    <link rel="stylesheet" href="css/modern.css">
</head>
<body>
    <div class="game-container">
        
        <aside class="col">
            <h2 style="color:var(--mint); margin-bottom:25px;">[ CHAOS_ID ]</h2>
            
            <div class="stat-group">
                <div class="label">Identity</div>
                <div class="val" id="dispCallsign">---</div>
            </div>
            
            <div class="stat-group">
                <div class="label">Reputation</div>
                <div class="val" id="dispTrust">50%</div>
            </div>

            <div class="stat-group">
                <div class="label">System Rank</div>
                <div class="val" id="dispRank" style="font-size:12px;">NOVICE</div>
            </div>

            <div style="margin-top:auto;">
                <button class="cmd" onclick="execute('VOTE')">>> EXECUTE_VOTE</button>
                <button class="cmd" onclick="execute('AUTH')">>> EXECUTE_HANDSHAKE</button>
                <button class="cmd" style="color:var(--slate); border-color:#333;">>> VIEW_SDK_DOCS</button>
            </div>
        </aside>

        <main class="col" style="background:var(--iron);">
            <div class="terminal-feed" id="feed">
                <div class="line"><span class="time">[00:00:00]</span> Establishing encrypted link to Overthere.ai...</div>
                <div class="line"><span class="time">[00:00:00]</span> Chaos Protocol Active.</div>
            </div>
            
            <div id="eagleBox" style="display:none; margin-top:20px;">
                <button class="cmd eagle-mode" style="width:100%;" onclick="eaglePurge()">>> EAGLE_OVERSIGHT: PURGE_GLOBAL_DATA</button>
            </div>
        </main>

        <aside class="col">
            <h4 style="color:var(--slate); margin-bottom:15px;">// THE_ABYSS_VAULT</h4>
            <div id="vaultList" style="font-size:11px; color:#999; overflow-y:auto;">
                Vault is empty. Execute a protocol to begin.
            </div>
            
            <div style="margin-top:auto; padding-top:20px; border-top:1px solid #222;">
                <div class="label">Session Entropy</div>
                <div style="height:4px; background:#111; margin-top:5px; border-radius:2px;">
                    <div id="entropyBar" style="height:100%; width:0%; background:var(--mint); transition:0.3s;"></div>
                </div>
            </div>
        </aside>

    </div>

    <script src="js/chaos-core.js"></script>
    <script>
        const name = localStorage.getItem('CHAOS_CALLSIGN');
        if(!name) window.location.href = '/';

        const chaos = new ChaosID(name);
        const feed = document.getElementById('feed');

        function pushLog(msg, color="#e0e0e0") {
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = 'line';
            div.innerHTML = `<span class="time">[${time}]</span> <span style="color:${color}">${msg}</span>`;
            feed.appendChild(div);
            feed.scrollTop = feed.scrollHeight;
        }

        // Setup
        document.getElementById('dispCallsign').innerText = chaos.callsign;
        document.getElementById('dispTrust').innerText = chaos.trust + "%";
        
        if(chaos.isAdmin) {
            document.getElementById('eagleBox').style.display = 'block';
            document.getElementById('dispRank').innerText = "MASTER_EAGLE";
            pushLog("ðŸ¦… EAGLE_OVERSIGHT DETECTED. ALL_SYSTEMS_GO.", "#ff4444");
        }

        async function execute(action) {
            pushLog("INITIATING " + action + " PROTOCOL...");
            const token = await chaos.generateProof(action);
            
            if(token.includes("ERROR")) {
                pushLog(token, "#ff4444");
            } else {
                pushLog("ENCRYPTION_COMPLETE: " + token, "#00ff9d");
                updateVault();
                document.getElementById('dispTrust').innerText = chaos.trust + "%";
            }
        }

        function updateVault() {
            const list = document.getElementById('vaultList');
            const data = JSON.parse(localStorage.getItem('ABYSS_VAULT')) || [];
            list.innerHTML = data.map(v => `<div style="margin-bottom:8px; border-bottom:1px solid #111; padding-bottom:4px;">> ${v.i}</div>`).reverse().join('');
        }

        // Entropy Visualizer
        setInterval(() => {
            const pct = (chaos.pool.length / 512) * 100;
            document.getElementById('entropyBar').style.width = pct + "%";
        }, 500);

        function eaglePurge() {
            if(confirm("MASTER: Purge local data?")) {
                localStorage.clear();
                window.location.reload();
            }
        }

        updateVault();
        pushLog("Welcome, " + name + ". Identify session authorized.");
    </script>
</body>
</html>
