<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chaosverse | API Dash</title>
    <link rel="stylesheet" href="css/modern.css">
    <script src="js/chaos-core.js"></script>
    <style>
        .api-console { background: #000; border: 1px solid #1a1a1a; padding: 15px; font-family: monospace; font-size: 10px; color: #00ff9d; height: 150px; overflow-y: auto; margin-top: 10px; }
        .loc-box { background: var(--iron-lite); border-left: 4px solid var(--gold); padding: 15px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="nexus-grid">
        <aside class="pane">
            <h2 style="color:var(--mint);">[ API_IDENTITY ]</h2>
            <div style="font-size: 10px; color: var(--slate); margin: 10px 0;">CALLSIGN</div>
            <div id="uName" style="color:var(--white); font-weight:bold;">---</div>
            
            <div style="font-size: 10px; color: var(--slate); margin: 10px 0;">SDK_KEY</div>
            <div id="uKey" style="color:var(--mint); font-size: 10px; word-break: break-all; background:#000; padding:5px;">---</div>

            <h3 style="color:var(--gold); margin-top: 30px;">[ SKILL_WEB ]</h3>
            <div id="skillTree" style="font-size:10px; color:var(--slate);">Initializing PoE 2 Passives...</div>
        </aside>

        <main class="pane">
            <div id="currentLoc" class="loc-box">
                <div class="label">CURRENT_COORDINATES</div>
                <h3 id="locName" style="color:var(--gold);">Sector 0000-Origin</h3>
                <div id="locStats" style="font-size:11px; color:var(--slate);">Danger: 0 | Loot: x1.0</div>
            </div>

            <div id="mainFeed" class="feed" style="height: 300px;"></div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                <button class="cmd-btn" onclick="travel()">>> WARP_TO_NEW_COORDS</button>
                <button class="cmd-btn" onclick="apiAction('SCAVENGE')">>> API_SCAVENGE</button>
            </div>

            <div class="api-console" id="apiConsole">
                > System Boot: API Listening...
            </div>
        </main>

        <aside class="pane">
            <h2 style="color:var(--slate);">[ LOOT_VAULT ]</h2>
            <div id="invGrid" class="inv-grid"></div>
        </aside>
    </div>

    <script>
        const cSign = localStorage.getItem('CHAOS_CALLSIGN') || "GUEST";
        const cHash = localStorage.getItem('CHAOS_IDENTITY_HASH') || "000";
        
        const verse = new ChaosVerse(cSign, cHash);
        document.getElementById('uName').innerText = verse.callsign;
        document.getElementById('uKey').innerText = verse.apiKey;

        function logAPI(msg) {
            const con = document.getElementById('apiConsole');
            con.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>`;
            con.scrollTop = con.scrollHeight;
        }

        async function apiAction(act) {
            logAPI(`POST /api/v1/chaos/${act} HTTP/1.1`);
            const res = await verse.callAPI(act);
            if(res.error) {
                logAPI(`RES: 403 Forbidden - ${res.error}`);
            } else {
                logAPI(`RES: 200 OK - TXID: ${res.id}`);
                document.getElementById('mainFeed').innerHTML += `<div class="line" style="color:var(--mint)">> ${act} Protocol Verified.</div>`;
            }
        }

        function travel() {
            const coords = Math.floor(Math.random() * 999999);
            const loc = verse.generateLocation(coords);
            document.getElementById('locName').innerText = loc.name;
            document.getElementById('locStats').innerText = `Danger: ${loc.danger} | Loot: x${loc.loot_mult}`;
            logAPI(`GET /api/v1/world/warp/${coords}`);
            document.getElementById('mainFeed').innerHTML += `<div class="line" style="color:var(--gold)">> Warping to ${loc.name}...</div>`;
        }

        travel();
    </script>
</body>
</html>
