<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHAOS ID | COMMAND CENTER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* CORE AESTHETIC */
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono:wght@400;700&display=swap');
        body { background-color: #000; color: #00ff41; font-family: 'Share Tech Mono', monospace; overflow-x: hidden; }
        
        .neon-border { border: 1px solid rgba(0, 255, 65, 0.3); box-shadow: 0 0 15px rgba(0, 255, 65, 0.1); }
        .glass-panel { background: rgba(0, 20, 0, 0.85); backdrop-filter: blur(5px); border: 1px solid #004400; }
        
        /* MATRIX RAIN BG */
        #matrix-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.1; }

        /* LIVE METRICS */
        .stat-card { transition: all 0.3s; }
        .stat-card:hover { transform: translateY(-2px); border-color: #00ff41; box-shadow: 0 0 20px rgba(0, 255, 65, 0.2); }
        
        .blink { animation: blink 1s step-end infinite; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <canvas id="matrix-canvas"></canvas>

    <!-- TOP NAV -->
    <nav class="p-4 md:p-6 flex justify-between items-center border-b border-green-900 bg-black/80 backdrop-blur z-10">
        <div class="flex items-center gap-4">
            <div class="text-2xl font-bold tracking-widest text-white">CHAOS<span class="text-green-500">CORE</span></div>
            <div class="hidden md:block px-2 py-0.5 text-[10px] border border-green-700 rounded text-green-700">ADMIN CLEARANCE</div>
        </div>
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-2 text-xs">
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                <span class="text-green-400">SECURE LINK</span>
            </div>
            <button onclick="logout()" class="text-xs text-red-500 hover:text-white transition border border-red-900 px-3 py-1 rounded hover:bg-red-900/20">
                DISCONNECT
            </button>
        </div>
    </nav>

    <!-- MAIN DASHBOARD -->
    <main class="flex-grow p-6 md:p-10 max-w-7xl mx-auto w-full z-10">
        
        <!-- WELCOME BANNER -->
        <div class="mb-10 flex flex-col md:flex-row justify-between items-end gap-4 border-b border-green-900 pb-6">
            <div>
                <h1 class="text-3xl md:text-5xl font-bold text-white mb-2">COMMAND CENTER</h1>
                <p class="text-green-600/80 text-sm md:text-base">Protocol: <span class="text-green-400">V125 LIVE</span> | Session: <span id="session-hash" class="text-white">LOADING...</span></p>
            </div>
            <div class="text-right hidden md:block">
                <div class="text-[10px] text-gray-500">SYSTEM TIME</div>
                <div id="clock" class="text-xl text-green-500">00:00:00</div>
            </div>
        </div>

        <!-- QUICK ACTIONS GRID -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            
            <!-- ACTION 1: KEY FORGE (REVENUE) -->
            <a href="/admin/portal" class="stat-card glass-panel p-6 rounded-xl group cursor-pointer block">
                <div class="flex justify-between items-start mb-4">
                    <i class="fas fa-key text-3xl text-yellow-500 group-hover:text-white transition"></i>
                    <i class="fas fa-arrow-right text-green-900 group-hover:text-green-500 transition"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-1">KEY FORGE</h3>
                <p class="text-xs text-gray-400">Generate and revoke Partner API keys. Manage Quotas.</p>
            </a>

            <!-- ACTION 2: OVERWATCH (DEFENSE) -->
            <a href="/admin" class="stat-card glass-panel p-6 rounded-xl group cursor-pointer block">
                <div class="flex justify-between items-start mb-4">
                    <i class="fas fa-eye text-3xl text-red-500 group-hover:text-white transition"></i>
                    <i class="fas fa-arrow-right text-green-900 group-hover:text-green-500 transition"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-1">OVERWATCH</h3>
                <p class="text-xs text-gray-400">Real-time threat monitoring and self-healing diagnostics.</p>
            </a>

            <!-- ACTION 3: SDK DOCS (GROWTH) -->
            <a href="/sdk" class="stat-card glass-panel p-6 rounded-xl group cursor-pointer block">
                <div class="flex justify-between items-start mb-4">
                    <i class="fas fa-code text-3xl text-blue-500 group-hover:text-white transition"></i>
                    <i class="fas fa-arrow-right text-green-900 group-hover:text-green-500 transition"></i>
                </div>
                <h3 class="text-xl font-bold text-white mb-1">INTEGRATION SDK</h3>
                <p class="text-xs text-gray-400">Developer documentation for MBF and Chaos Pulse.</p>
            </a>

        </div>

        <!-- REAL-TIME TELEMETRY PREVIEW -->
        <div class="glass-panel p-1 rounded-xl">
            <div class="bg-black/50 p-3 flex justify-between items-center border-b border-green-900">
                <span class="text-xs font-bold text-green-500"><i class="fas fa-satellite-dish mr-2"></i> LIVE TRAFFIC</span>
                <span class="text-[10px] text-gray-500">SOURCE: ABYSS NODE 01</span>
            </div>
            <div class="p-6 grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
                <div>
                    <div class="text-[10px] text-gray-500 mb-1">TOTAL REQUESTS</div>
                    <div id="metric-req" class="text-2xl font-bold text-white">0</div>
                </div>
                <div>
                    <div class="text-[10px] text-gray-500 mb-1">THREATS BLOCKED</div>
                    <div id="metric-block" class="text-2xl font-bold text-red-500">0</div>
                </div>
                <div>
                    <div class="text-[10px] text-gray-500 mb-1">STATUS</div>
                    <div class="text-2xl font-bold text-blue-400">ONLINE</div>
                </div>
                <div>
                    <div class="text-[10px] text-gray-500 mb-1">UPTIME</div>
                    <div id="metric-uptime" class="text-2xl font-bold text-green-400">99.9%</div>
                </div>
            </div>
            
            <!-- LIVE LOGS FEED -->
            <div id="live-logs" class="p-4 bg-black/80 font-mono text-[10px] text-green-400 h-32 overflow-y-auto border-t border-green-900">
                <div>> Initializing Telemetry Stream...</div>
            </div>
        </div>

    </main>

    <script>
        // --- 1. AUTH CHECK ---
        const session = sessionStorage.getItem('chaos_session');
        if (!session) window.location.href = '/app';
        
        document.getElementById('session-hash').innerText = session.substring(0, 12) + '...';

        function logout() {
            sessionStorage.clear();
            window.location.href = '/app';
        }

        // --- 2. MATRIX RAIN ---
        const c = document.getElementById('matrix-canvas');
        const ctx = c.getContext('2d');
        c.width = window.innerWidth; c.height = window.innerHeight;
        const font_size = 12;
        const columns = c.width / font_size;
        const drops = Array(Math.floor(columns)).fill(1);

        function draw() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, c.width, c.height);
            ctx.fillStyle = '#0F0';
            ctx.font = font_size + 'px monospace';
            for (let i = 0; i < drops.length; i++) {
                const text = String.fromCharCode(0x30A0 + Math.random() * 96);
                ctx.fillText(text, i * font_size, drops[i] * font_size);
                if (drops[i] * font_size > c.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }
        setInterval(draw, 50);

        // --- 3. LIVE CLOCK & REAL TELEMETRY POLL ---
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
        }, 1000);

        setInterval(async () => {
            try {
                // Fetch REAL Data from Server
                const res = await fetch('/api/v1/admin/telemetry');
                const data = await res.json();
                
                // Update Metrics
                document.getElementById('metric-req').innerText = data.stats.requests;
                document.getElementById('metric-block').innerText = data.stats.threats;
                
                // Update Logs
                const logContainer = document.getElementById('live-logs');
                if (data.logs && data.logs.length > 0) {
                    // Clear and repopulate to show latest (simple sync)
                    logContainer.innerHTML = '';
                    data.logs.forEach(log => {
                        const div = document.createElement('div');
                        div.innerText = log;
                        if(log.includes("BLOCK")) div.className = "text-red-500";
                        else if(log.includes("SYSTEM")) div.className = "text-yellow-500";
                        logContainer.appendChild(div);
                    });
                }
            } catch(e) {
                // Keep silent on fail to avoid UI flicker
            }
        }, 2000);
        
        // Initial Fetch
        fetch('/api/v1/admin/telemetry')
            .then(r => r.json())
            .then(data => {
                 document.getElementById('metric-req').innerText = data.stats.requests;
            }).catch(console.error);

        window.addEventListener('resize', () => { c.width = window.innerWidth; c.height = window.innerHeight; });
    </script>
</body>
</html>
