<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chaosverse | Infinite Nexus</title>
    <link rel="stylesheet" href="css/modern.css">
    <script src="js/chaos-core.js"></script>
    <script src="js/skill-engine.js"></script>
    <style>
        .skill-web-container {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px; padding: 20px; background: #050505; border: 1px solid #111;
            height: 300px; overflow-y: auto;
        }
        .node-circle {
            width: 50px; height: 50px; border-radius: 50%; border: 1px solid var(--slate);
            display: flex; align-items: center; justify-content: center; font-size: 8px;
            cursor: pointer; transition: 0.3s;
        }
        .node-circle.active { border-color: var(--mint); color: var(--mint); box-shadow: 0 0 10px var(--mint-glow); }
        .node-circle:hover { transform: scale(1.1); background: #111; }
    </style>
</head>
<body>
    <div class="nexus-grid">
        <aside class="pane">
            <h2 style="color:var(--mint);">[ ${localStorage.getItem('CHAOS_CALLSIGN')} ]</h2>
            <div id="jobTitle" style="color:var(--gold); font-size: 10px; margin-bottom: 20px;">OCCUPATION: ---</div>
            
            <div class="vital-row">
                <div class="vital-header"><span>Skill Points (XP)</span><span id="txtXP">0</span></div>
                <div class="bar-frame"><div id="barXP" class="bar-fill" style="background:var(--gold); width: 0%;"></div></div>
            </div>

            </aside>

        <main class="pane">
            <div id="feed" class="feed" style="height: 150px;">
                <div class="line">>> System online. Skill Web established.</div>
            </div>

            <h4 style="color:var(--slate); margin: 15px 0 5px;">// PASSIVE_SKILL_WEB (PoE 2)</h4>
            <div class="skill-web-container" id="skillWeb">
                </div>

            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 20px;">
                <button class="btn-protocol" onclick="trigger('CHAOS')">üåÄ CHAOS</button>
                <button class="btn-protocol" onclick="trigger('ABYSS')">üï≥Ô∏è ABYSS</button>
                <button class="btn-protocol" onclick="trigger('NIGHTMARE')">üåë NIGHTMARE</button>
                <button class="btn-protocol" onclick="trigger('DREAM')">‚ú® DREAM</button>
            </div>
        </main>

        <aside class="pane">
            <h3 style="color:var(--slate);">[ ABYSS_VAULT ]</h3>
            <div id="inventory"></div>
        </aside>
    </div>

    <script>
        // Init Player and Skill Engine
        const playerRaw = localStorage.getItem('CHAOS_PLAYER') || JSON.stringify({job: 'NETRUNNER', xpPool: 50});
        const player = JSON.parse(playerRaw);
        const engine = new SkillEngine(player);
        
        document.getElementById('jobTitle').innerText = "OCCUPATION: " + engine.job;

        function renderWeb() {
            const container = document.getElementById('skillWeb');
            container.innerHTML = '';
            engine.tree.forEach(node => {
                const div = document.createElement('div');
                div.className = 'node-circle' + (node.locked ? '' : ' active');
                div.innerText = node.id.split('-')[0].substring(0,1) + node.id.split('-')[1];
                div.title = `${node.name} | Power: +${node.power}`;
                div.onclick = () => unlockNode(node);
                container.appendChild(div);
            });
            document.getElementById('txtXP').innerText = Math.floor(engine.xpPool);
        }

        function unlockNode(node) {
            if(engine.xpPool >= node.cost && node.locked) {
                engine.xpPool -= node.cost;
                node.locked = false;
                renderWeb();
                save();
            }
        }

        function save() {
            localStorage.setItem('CHAOS_PLAYER', JSON.stringify({
                job: engine.job,
                tree: engine.tree,
                xpPool: engine.xpPool
            }));
        }

        renderWeb();
    </script>
</body>
</html>
