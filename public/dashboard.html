<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chaos Nexus | Living World</title>
    <link rel="stylesheet" href="css/modern.css">
    <script src="js/chaos-core.js"></script>
    <script src="js/loot-engine.js"></script>
</head>
<body>
    <div class="nexus-grid">
        <aside class="pane">
            <h2 style="color:var(--mint);">[ IDENTITY ]</h2>
            <div id="uName" style="color:var(--gold); font-size:1.2rem; margin-bottom:20px;">---</div>
            
            <div class="vital-container">
                <div class="vital-label"><span>SENTINEL MONITOR</span><span id="botTxt">CLEAN</span></div>
                <div class="bar-bg"><div id="botBar" class="bar-fill" style="--fill-color: var(--mint); width: 0%;"></div></div>
            </div>

            <div class="vital-container">
                <div class="vital-label"><span>CHAOS PULSE</span><span id="pulseTxt">100%</span></div>
                <div class="bar-bg"><div id="pulseBar" class="bar-fill" style="--fill-color: var(--gold); width: 100%;"></div></div>
            </div>

            <div style="margin-top:auto; padding:15px; background:#000; border:1px solid #222;">
                <div style="font-size:10px; color:var(--slate);">GLOBAL ACTIVITY</div>
                <div id="globalPulse" style="color:var(--mint); font-weight:bold; font-size:14px;">---</div>
            </div>
        </aside>

        <main class="pane">
            <div class="feed" id="feed"></div>
            <button class="btn-chaos" onclick="triggerScavenge()">SCANNED_SCAVENGE</button>
        </main>

        <aside class="pane">
            <h2 style="color:var(--slate);">[ ABYSS_VAULT ]</h2>
            <div class="inv-grid" id="invGrid"></div>
        </aside>
    </div>

    <script>
        const app = new ChaosID(localStorage.getItem('CHAOS_CALLSIGN') || "GUEST");
        document.getElementById('uName').innerText = app.callsign;

        function log(m, c="#aaa") {
            const f = document.getElementById('feed');
            f.innerHTML += `<div class="line" style="color:${c}">> ${m}</div>`;
            f.scrollTop = f.scrollHeight;
        }

        function triggerScavenge() {
            const item = LootEngine.generate(app);
            if(item === "ERR_NIGHTMARE") {
                log("NIGHTMARE_DEFENSE: Pattern rejected.", "var(--blood)");
            } else if (item) {
                log(`LOOT_FOUND: ${item.name}`, item.color);
                const slot = document.createElement('div');
                slot.className = 'slot';
                slot.innerHTML = `<span style="color:${item.color}">${item.icon}</span>`;
                document.getElementById('invGrid').prepend(slot);
            }
        }

        // --- GLOBAL PULSE ENGINE ---
        setInterval(() => {
            // Simulated Global Counter based on real Chaos
            const active = Math.floor(Math.random() * 50) + 1492032;
            document.getElementById('globalPulse').innerText = active.toLocaleString() + " LOGS";
            
            // Bot Detection UI
            const botPct = (app.botScore / 20) * 100;
            document.getElementById('botBar').style.width = botPct + "%";
            document.getElementById('botBar').style.setProperty('--fill-color', botPct > 50 ? 'var(--blood)' : 'var(--mint)');
            document.getElementById('botTxt').innerText = botPct > 50 ? "WARNING" : "CLEAN";
        }, 2000);

        log("SENTINEL ACTIVE. MONITORING ENTROPY QUALITY...");
    </script>
</body>
</html>
