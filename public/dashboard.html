<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chaos Nexus | Infinite</title>
    <link rel="stylesheet" href="css/modern.css">
</head>
<body>
    <div class="nexus-grid">
        <aside class="pane">
            <h2 style="color:var(--mint);">[ IDENTITY ]</h2>
            <div style="font-size:2rem; margin:10px 0;">ðŸ‘¤ <span id="userName" style="font-size:1rem; color:var(--mint);">...</span></div>
            
            <div class="label">ENTROPY_RESERVE</div>
            <div class="status-bar"><div id="barEntropy" class="fill-mint" style="width:0%"></div></div>
            
            <div class="label">TRUST_STABILITY</div>
            <div class="status-bar"><div id="barTrust" class="fill-mint" style="width:50%"></div></div>

            <div class="label">CHAOS_LEVEL</div>
            <div class="status-bar"><div id="barLvl" class="fill-gold" style="width:10%"></div></div>

            <h4 style="color:var(--slate); margin:20px 0 10px;">// SKILL_TREE_V2</h4>
            <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:10px;">
                <div class="node" style="width:40px;height:40px;border:1px solid var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--gold);">S</div>
                <div class="node" style="width:40px;height:40px;border:1px solid var(--slate);border-radius:50%;display:flex;align-items:center;justify-content:center;">A</div>
                <div class="node" style="width:40px;height:40px;border:1px solid var(--slate);border-radius:50%;display:flex;align-items:center;justify-content:center;">V</div>
                <div class="node" style="width:40px;height:40px;border:1px solid var(--slate);border-radius:50%;display:flex;align-items:center;justify-content:center;">E</div>
            </div>
        </aside>

        <main class="pane">
            <div class="feed" id="mainFeed">
                <div class="line" style="color:var(--slate)">[SYSTEM] Link Established to Overthere.ai...</div>
            </div>

            <div id="npcEvent" class="event-box">
                <div id="npcTitle" style="color:var(--gold); font-weight:bold;">SUDDEN ENCOUNTER</div>
                <div id="npcDesc" style="margin:10px 0;">A mysterious entity approaches...</div>
                <div id="npcChoices"></div>
            </div>

            <div style="margin-top:20px; display:flex; gap:10px;">
                <button onclick="manualVerify()" style="flex:1; background:var(--mint); color:#000; border:none; padding:12px; cursor:pointer; font-weight:bold;">EXECUTE_HANDSHAKE</button>
            </div>
        </main>

        <aside class="pane">
            <h2 style="color:var(--slate);">// ABYSS_VAULT</h2>
            <div id="vault" style="font-size:10px; color:#666; height:200px; overflow-y:auto; border-bottom:1px solid #222; margin-bottom:20px;"></div>
            
            <h4 style="color:var(--slate);">// WORLD_EVENTS</h4>
            <div id="worldLog" class="feed" style="height:200px; border:none; font-size:10px;"></div>

            <div id="masterEagles" style="display:none; margin-top:auto; border:1px solid var(--blood); padding:10px;">
                <h4 style="color:var(--blood)">EAGLE_VIEW_ACTIVE</h4>
            </div>
        </aside>
    </div>

    <script src="js/chaos-core.js"></script>
    <script>
        const name = localStorage.getItem('CHAOS_CALLSIGN') || "GUEST";
        document.getElementById('userName').innerText = name;
        const chaos = new ChaosID(name);
        if(chaos.isAdmin) document.getElementById('masterEagles').style.display='block';

        function log(msg, target='mainFeed', color='#e0e0e0') {
            const f = document.getElementById(target);
            const l = document.createElement('div');
            l.className = 'line';
            l.innerHTML = `<span style="color:${color}">> ${msg}</span>`;
            f.appendChild(l);
            f.scrollTop = f.scrollHeight;
        }

        async function manualVerify() {
            log("Initiating manual verification...", 'mainFeed', '#00ff9d');
            const token = await chaos.generateProof("AUTH");
            log("TOKEN_GEN: " + token, 'mainFeed', '#00ff9d');
            updateVault();
        }

        function updateVault() {
            const v = document.getElementById('vault');
            const data = JSON.parse(localStorage.getItem('ABYSS_VAULT')) || [];
            v.innerHTML = data.map(i => `<div>${i.i}</div>`).reverse().join('');
        }

        // --- THE CHAOS NPC ENGINE (OSRS STYLE) ---
        const NPCs = [
            { name: "The Wise Glitch", lines: ["Chaos is the only truth.", "Your entropy is high today."], rewards: 5 },
            { name: "Abyss Scraper", lines: ["Give me your data.", "Scanning your vault..."], rewards: -2 },
            { name: "Mint Sentinel", lines: ["Reputation is your shield.", "Identify yourself."], rewards: 10 }
        ];

        function spawnEvent() {
            const npc = NPCs[Math.floor(Math.random() * NPCs.length)];
            const box = document.getElementById('npcEvent');
            document.getElementById('npcTitle').innerText = "ENCOUNTER: " + npc.name;
            document.getElementById('npcDesc').innerText = npc.lines[Math.floor(Math.random()*npc.lines.length)];
            
            const choices = document.getElementById('npcChoices');
            choices.innerHTML = `
                <div class="choice" onclick="resolveEvent(1, '${npc.name}')">[1] Verify with Chaos</div>
                <div class="choice" onclick="resolveEvent(0, '${npc.name}')">[2] Deflect into Abyss</div>
            `;
            box.style.display = 'block';
            log(npc.name + " has appeared.", 'worldLog', '#ffb300');
        }

        function resolveEvent(success, npcName) {
            document.getElementById('npcEvent').style.display = 'none';
            if(success) {
                log("You verified with " + npcName + ". Trust gained.", 'mainFeed', '#00ff9d');
                chaos.trust = Math.min(100, chaos.trust + 5);
            } else {
                log("You deflected " + npcName + ". Entropy conserved.", 'mainFeed', '#64748b');
            }
            document.getElementById('barTrust').style.width = chaos.trust + "%";
        }

        // Random Event Timer (Chaos amount of playstyle)
        setInterval(() => {
            if(Math.random() > 0.7) spawnEvent();
        }, 30000);

        setInterval(() => {
            document.getElementById('barEntropy').style.width = (chaos.pool.length / 512 * 100) + "%";
        }, 1000);

        updateVault();
    </script>
</body>
</html>
