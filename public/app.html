<script>
        const { startRegistration, startAuthentication } = SimpleWebAuthnBrowser;
        const HEADERS = { 'Content-Type': 'application/json', 'X-APLUS-SECURE': 'TOTEM_V8_BIO' };
        
        // UTILS (HUD, Toast, Buzz) ... (Same as before)
        function updateHUD(text, color) { document.getElementById('hud').innerText = text; document.getElementById('hud').className = `hud-status ${color}`; }
        function showToast(msg) { const x = document.getElementById("toast"); x.innerText = msg; x.className = "show"; setTimeout(() => x.className="", 3000); }
        function buzz() { if (navigator.vibrate) navigator.vibrate([50]); }

        // --- REGISTER ---
        async function doRegister() {
            updateHUD("CONNECTING...", "text-yellow-400");
            try {
                const resp = await fetch('/api/v1/auth/register-options', { headers: HEADERS });
                const opts = await resp.json();
                
                updateHUD("SCAN FINGERPRINT", "text-white animate-pulse");
                buzz();
                const attResp = await startRegistration(opts);
                
                updateHUD("VERIFYING...", "text-blue-400");
                const verifyResp = await fetch('/api/v1/auth/register-verify', {
                    method: 'POST', headers: HEADERS, body: JSON.stringify(attResp)
                });
                const result = await verifyResp.json();

                if (result.verified) {
                    updateHUD("ACCESS SECURED", "text-green-500");
                    
                    // --- V21: MOBILE COPY MODAL ---
                    if (result.adminDNA) {
                        // Create a temporary text area to copy from
                        const dna = result.adminDNA;
                        const copyArea = document.createElement('textarea');
                        copyArea.value = dna;
                        copyArea.style.position = 'fixed'; // Avoid scrolling to bottom
                        copyArea.style.left = '0';
                        copyArea.style.top = '0';
                        copyArea.style.width = '100%';
                        copyArea.style.height = '100px'; // Big enough to tap
                        copyArea.style.zIndex = '9999';
                        copyArea.style.background = '#222';
                        copyArea.style.color = '#0f0';
                        document.body.appendChild(copyArea);
                        
                        copyArea.focus();
                        copyArea.select();
                        
                        try {
                            document.execCommand('copy');
                            alert("ADMIN DNA COPIED TO CLIPBOARD!\n\nPaste this into your Render Environment Variables.");
                        } catch (err) {
                            alert("COPY FAILED. Manually copy the text at the top of the screen.");
                        }
                        
                        // Keep it visible just in case auto-copy failed
                        setTimeout(() => document.body.removeChild(copyArea), 10000); 
                    }
                    
                } else { throw new Error("Verification Rejected"); }
            } catch (e) { updateHUD("FAILED", "text-red-500"); showToast(e.message); }
        }

        // --- LOGIN ---
        async function doLogin() {
            // ... (Keep existing Login logic) ...
            // This part is fine.
             updateHUD("CONNECTING...", "text-blue-400");
            try {
                const resp = await fetch('/api/v1/auth/login-options', { headers: HEADERS });
                if(!resp.ok) throw new Error("User Not Found");
                const opts = await resp.json();
                updateHUD("SCAN FINGERPRINT", "text-white animate-pulse");
                buzz();
                const asseResp = await startAuthentication(opts);
                updateHUD("CHECKING...", "text-blue-400");
                const verifyResp = await fetch('/api/v1/auth/login-verify', {
                    method: 'POST', headers: HEADERS, body: JSON.stringify(asseResp)
                });
                const result = await verifyResp.json();
                if (result.verified) {
                    updateHUD("UNLOCKED", "text-green-500");
                    document.body.style.backgroundColor = "#002200"; 
                    if(result.token) {
                        sessionStorage.setItem('chaos_session', result.token);
                        sessionStorage.setItem('chaos_dna', "PIXEL-V8-SECURE");
                    }
                    setTimeout(() => window.location.href = '/dashboard.html', 1500);
                } else { throw new Error("Invalid Credentials"); }
            } catch (e) { updateHUD("DENIED", "text-red-500"); showToast(e.message); }
        }
    </script>
