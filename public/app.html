<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A+ VERIFY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="router.js"></script>
    <style>
        body { background: #000; color: #00ff41; font-family: monospace; height: 100vh; display: flex; align-items: center; justify-content: center; }
        canvas { border: 1px solid #005500; background: #050505; cursor: crosshair; }
    </style>
</head>
<body>
    <div class="text-center w-full max-w-md p-6">
        <h1 class="text-2xl font-bold mb-4 tracking-widest">ENTER ABYSS</h1>
        
        <input id="callsign" type="text" placeholder="ENTER CALLSIGN" 
               class="w-full bg-gray-900 border border-green-900 p-3 text-center text-white mb-6 focus:outline-none focus:border-green-500 rounded">
        
        <canvas id="canvas" width="300" height="200" class="mx-auto mb-4 rounded"></canvas>
        <p id="status" class="text-xs text-gray-500 mb-6">Draw your sigil to verify presence.</p>
        
        <button onclick="login()" id="btn" class="w-full bg-green-900 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition">
            VERIFY IDENTITY
        </button>
    </div>

    <script>
        // Auto-fill from history
        if(localStorage.getItem('callsign_history')) {
            document.getElementById('callsign').value = localStorage.getItem('callsign_history');
        }

        // Drawing Logic
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;
        let points = 0;

        function start(e) { e.preventDefault(); drawing = true; points=0; ctx.clearRect(0,0,300,200); }
        function move(e) {
            if(!drawing) return;
            e.preventDefault();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - canvas.getBoundingClientRect().left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - canvas.getBoundingClientRect().top;
            ctx.lineTo(x,y); ctx.strokeStyle='#00ff41'; ctx.lineWidth=2; ctx.stroke();
            points++;
        }
        function end() { drawing = false; ctx.beginPath(); }

        ['mousedown','touchstart'].forEach(e=>canvas.addEventListener(e, start));
        ['mousemove','touchmove'].forEach(e=>canvas.addEventListener(e, move));
        ['mouseup','touchend'].forEach(e=>canvas.addEventListener(e, end));

        // Login Logic
        function login() {
            const callsign = document.getElementById('callsign').value.toUpperCase();
            if(!callsign) return alert("Callsign required.");
            if(points < 20) return alert("Trace your sigil properly.");

            // Success Ritual
            localStorage.setItem('chaos_key_vault', 'sk_live_' + Date.now());
            localStorage.setItem('session_start', Date.now());
            localStorage.setItem('callsign_history', callsign);
            
            document.getElementById('btn').textContent = "ACCESS GRANTED";
            document.getElementById('btn').classList.replace('bg-green-900', 'bg-green-500');
            
            setTimeout(() => window.location.href = '/dashboard', 800);
        }
    </script>
</body>
</html>
